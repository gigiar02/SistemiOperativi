/*
   Creato il 03/04/2025
   La traccia Ã¨ nella directory

*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/types.h>
#include <limits.h>

#define PATHMAX 4500
//Eseguire tutti i file eseguibili da "Others"
int main()
{
	
	char path[PATHMAX];
	struct *DIR dir;
	struct *DIRENT currentFile;
	struct stat  buff; 


	//ottengo la directory corrente
	char *res = getcwd(path,sizeof(path));
	if(res == NULL) return -1;
	
	//Apro la directory
	dir = opendir(path);
	if(dir == NULL) return -1;

	//Scorro tutti i file all'interno della mia directory
	while(currentFile = opendir(dir))
	{
		//Prendo le informazioni sul file
		if(!stat(currentFile->name,&buff)) return -1;
		
		//Verifico che gli altri abbiano il permesso di eseguire il file
		if(buff.mode & S_IXOTH)
		{
			printf("File : %s Permesso di esecuzione OK",currentFile->name);

			//Il figlio esegue il file
			if(fork() == 0)
			{
				execl(currentFile->name,currentFile->name,"NULL");
				exit(10);
			}
		}	

	}
	

}